<!DOCTYPE html>

<head>
    <meta charset="utf-8"/>
    <title>Titre</title>
    <script src="public/jquery-3.3.1.min.js"></script>
    <script src="public/ajaxRequest.js"></script>
    <link rel="stylesheet" href="public/bootstrap.min.css">
    <link rel="stylesheet" href="public/stye.css">
</head>
<body>


<table class="table table-dark" id="usertable" border="1">
</table>

<form id="form" class="form-row">

    <input type="hidden" name="id" value="id" class="form-control"/>

    <div class="row">
        Lastname<input type="text" name="lastname" value="lastname" class="form-control"/>
    </div>
    <div class="row">
        Firstname<input type="text" name="firstname" value="firstname" class="form-control"/>
    </div>

    <div class="row">
        Date birth<input type="datetime-local" name="dateNaissance" value="2018-07-23 08:07:34"
                         class="form-control"/>
    </div>
    <br>
    <div class="row">
        <button class="btn btn-primary" type="submit" id="submit">Send</button>
        <button class="btn btn-danger" type="submit" id="modify">Modify</button>
    </div>

</form>

<script>

    //load d'users
    laodUsers();

    //create user
    $("#form").on('submit', function (event) {
        event.preventDefault();
        createUser($(this));
    });

    //delete user
    $(document).on("click", '.delete', function (event) {
        event.preventDefault();
        deleteUser($(this));
    });

    //modify user
    $(document).on("click", '.modify', function () {
        event.preventDefault();
        //modifyUser()

        //enregistre mes donn√©es user dans des var
        var id = $(this).closest("tr").find("td input").val();
        var lastName = $(this).closest("tr").find("td.lastName").text();
        var firstName = $(this).closest("tr").find("td.firstName").text();
        var date_naissance = $(this).closest("tr").find("td.dateNaissance").text();

        //j'affecte mes valeur recuperer dans mon formulaires
        $('#form').find('input[name=id]').val(id);
        $('#form').find('input[name=lastname]').val(lastName);
        $('#form').find('input[name=firstname]').val(firstName);
        $('#form').find('input[name=dateNaissance]').val(date_naissance);


        $("#modify").on('click', function (event) {
            //je parcour mon formulaire et remplit mon tableau result
            var result = {};
            $.each($("#form").serializeArray(), function () {
                result[this.name] = this.value;
            });
            //j'envoie mono tableau a mon api
            $.ajax('http://127.0.0.1:8000/user/modify/' + id, {
                type: 'POST',
                dataType: 'json',
                data: JSON.stringify(result),

                success: function () {
                    laodUsers();
                },
                error: function () {
                    alert('error modify');
                }
            });
        });
    });


</script>
</body>
</html>
